<html>
<head>
<meta charset="utf-8"/>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“ˆ</text></svg>">
<link href="${static_dir}/main.css" rel="stylesheet" />
<link href="${static_dir}/hover_index.css" rel="stylesheet" />

<script defer src="https://use.fontawesome.com/releases/v5.0.10/js/all.js" integrity="sha384-slN8GvtUJGnv6ca26v8EzVaR9DC58QEwsIk9q1QXdCU8Yu8ck/tL/5szYlBbqmS+" crossorigin="anonymous"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet" />
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>

<a id="top"></a>
<a href="${home}"><button class="btn"><i class="fa fa-home"></i></button></a>
<a href="${benchmark}.html"><button class="btn"><i class="fa fa-arrow-left"></i> ${benchmark}</button></a>

<h1>Result on ${benchmark} benchmark</h1>
<summary></summary>
<p><a href="${result['fname']}">
	<button class="btn"><i class="fa fa-download"></i> ${result["fname_short"]}</button>
</a></p>

<!--Display all system informations if you want to-->
% if any([val != "" for _, val in result['sysinfo']['sub'].items()]):
<p>System informations:
  % for name, val in result['sysinfo']['main'].items():
    % if val != "":
      <b>${name}</b>: ${val}
    % endif
  % endfor
    <button id="btn_subinfo" class="button buttonleft toggle">
      <i class='fas fa-plus-circle' id="logo_btn_info"></i>
    </button>
    <div id="subinfo" style="display:none;transition: 0.5s;">
      <ul>
        % for key_sub, val_sub in result['sysinfo']['sub'].items():
          % if val_sub != "":
            <li> <b>${key_sub}</b>: ${val_sub} </li>
          % endif
        %endfor
        % for key_ter, val_ter in result['sysinfo']['ter'].items():
          % if val_ter != "":
            <%
                val = val_ter.split()
                val = [''.join(l for l in item if l.isalnum() or l in [".", "_", '=']) for item in val]
                val = " ".join(val)
            %>
            <li> <b>${key_ter}</b>: ${val} </li>
          % endif
        %endfor
      </ul>
    </div>
  </p>
  %endif


<!-- Add selector to display only one plot -->
<label for='dataset_selector'>Dataset:</label>
<select id='dataset_selector' onchange="showMe(this); set_visibility();">
% for data in result['dataset_names']:
  <option value="${data}">${data}</option>
%endfor
</select>
<label for='objective_selector'>Objective:</label>
<select id='objective_selector' onchange="showMe(this); set_visibility();">
% for obj in result['objective_names']:
  <option value="${obj}">${obj}</option>
%endfor
</select>
<select id='objective_column' onchange="showMe(this); set_visibility();">
% for obj_col in result['obj_cols']:
  <option value="${obj_col}">${obj_col.replace('objective_', '')}</option>
%endfor
</select>
<label for='plot_kind'>Kind:</label>
<select id='plot_kind' onchange="showMe(this); set_visibility();">
% for kind in result['kinds']:
  <option value="${kind}">${kind}</option>
%endfor
</select>

% for data in result['dataset_names']:
<div class="${data}">
  % for obj in result['objective_names']:
  <div class="${obj}">
    % for obj_col in result['obj_cols']:
    <div class="${obj_col}">
        <%
        changed_names = [data + obj + obj_col + kinds
                     for kinds in result['kinds'] if kinds != "histogram"]
        %>
      % for kind in result['kinds']:
      <div class="${kind}">
        <%
        fig = result['figures'][data][obj][obj_col][kind]
        %>
        % if fig.endswith('.svg'):
        <img src="${fig}"><br/>
        % else:
        <label for='change_scaling'>Axis type</label>
        <select id="change_scaling" onchange="changeScale(this,${changed_names})">
          <option value="semilog-y">semilog-y</option>
          <option value="loglog">loglog</option>
        </select>
        <div id="${data + obj + obj_col + kind}">
          ${fig}
        </div>
          %endif
      </div>
      %endfor
    </div>
    %endfor
  </div>
  %endfor
</div>
%endfor

<a class="backtotop" title="Back to top" href="#top"><i class="fas fa-level-up-alt"></i></a>

<script type="text/javascript">
	function showMe(e) {
		for (var i = 0; i < e.options.length; i++) {
			opt = e.options[i]
			var all_obj = document.getElementsByClassName(opt.value);
			for (var j =0; j< all_obj.length; j++)
				all_obj[j].style.display = "none";
		}
		var class_to_display = e.options[e.selectedIndex].value;
		var all_obj = document.getElementsByClassName(class_to_display);
		for (var j =0; j< all_obj.length; j++)
			all_obj[j].style.display = "block";
  }

  function changeScale(e, all_ids) {
    for (name = 0; name < all_ids.length; name++){
      container = document.getElementById(all_ids[name]);
      id_graph = container.getElementsByTagName("div")[1].id;
      graph = document.getElementById(id_graph);
      layout = graph.layout;
      switch (e.value) {
        case "loglog":
          layout.xaxis.type = "log";
          break;
        case "semilog-y":
          layout.xaxis.type = "linear";
          break;
        }
      Plotly.relayout(id_graph, layout);
    }
  }


  $('.toggle').click(function() {
    $(this).find('svg').toggleClass('fa-plus-circle fa-minus-circle');
    var x = document.getElementById("subinfo")
    if (x.style.display === 'none') {
      x.style.display = "block";
    }
    else {
      x.style.display = "none";
    }
  });

  var obj = document.getElementById('dataset_selector');
  obj.onchange();
  var prev_dataset = obj.value;
  var obj = document.getElementById("objective_selector");
  obj.onchange();
  var prev_obj_selector = obj.value;
  var obj = document.getElementById('objective_column');
  obj.onchange();
  var prev_obj_col = obj.value;
  var obj = document.getElementById('plot_kind');
  obj.onchange();
  var prev_kind = obj.value;

  function set_visibility() {
    var kind = document.getElementById('plot_kind').value;
    var dataset = document.getElementById("dataset_selector").value;
    var obj_select = document.getElementById("objective_selector").value;
    var obj_col = document.getElementById("objective_column").value;
    if(kind !== "histogram"){
      if(prev_kind != null){
        // Get list of visible traces in the graph from previous graph.
        var graph_id = document.querySelector('[id$="' + prev_dataset + prev_obj_selector + prev_obj_col + prev_kind + '"]').id;
        var graph = document.getElementById(document.getElementById(graph_id).getElementsByTagName("div")[1].id);
        var traces_visib = graph.data.map(trace => trace.visible);
        // Set the visible traces to the one from the previous graph.
        // This part ensures that the visible solvers are always the same
        // across the different plots (same dataset).
        if(prev_dataset === dataset){
          var graph_id = document.querySelector('[id$="' + dataset + obj_select + obj_col + kind + '"]').id;
          var graph = document.getElementById(document.getElementById(graph_id).getElementsByTagName("div")[1].id);
          for(i=0; i < graph.data.length; i++){
            graph.data[i].visible = traces_visib[i];
          }
          Plotly.redraw(graph);
        };
      };
      // Store the current graph id so we can update the visible traces on the next change.
      prev_kind = kind;
      prev_obj_col = obj_col;
      prev_obj_selector = obj_select;
      prev_dataset = dataset;
    };
  }

</script>
</body>
</html>
